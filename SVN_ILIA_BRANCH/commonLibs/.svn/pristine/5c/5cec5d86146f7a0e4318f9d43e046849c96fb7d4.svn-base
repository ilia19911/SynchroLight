#include "include.h"
#ifndef _PLAYER_H
#define _PLAYER_H

//state статусы
#define PLAYBACK_ENABLED	  1
#define PLAYBACK_DISABLED 	0


#define SYNCHRO_VALUE 127
#define DOPUSK 10

#define FRAME_IN_TEST_SCEN	18



#define HEADER_MEM_SIZE		100
#define HEADER_FRAME_SIZE	100

// структура состояния воспроизведения
#pragma pack(push, 1)
typedef struct 
{
		uint16_t 	instruction;						 				 //инструкция по воспроизведению фрейма
		uint16_t	crostime;												 // время воспроизведения в 0.1 мс
		uint16_t	holdtime;												 // время воспроизведения в 0.1 мс
		uint8_t 	buffer[HEADER_FRAME_SIZE]; 			 // буфер для хедера мема
																							 // состояние перехода
}frame;
#pragma pack(pop)

#pragma pack(push, 1)
typedef struct 
{	
		uint16_t		mem_number;											//адрес сцены в памяти
		uint16_t		number_of_frame; 								//количество сцен в меме
}playback;
#pragma pack(pop)

typedef struct
{
	playback 	playback_header;
	frame 		frame_header;
	frame 		previous_frame;
	uint8_t 	state;
	
	uint8_t		mem; 							 									// номер мема воспроизведения
	uint8_t		frame; 															// номер фрейма мема воспроизведения
	uint8_t 	rate; 						 									// относительная скорость возпроизведения
	uint8_t 	crosfade;														//коефициент перехода. от 0 до 1;
	uint8_t 	hold;																//коефициент задержки. от 0 до 1;
	uint32_t	frame_time_begine;									// время включения сцены
	
}player;

void player_start_mem(uint16_t mem_number, uint8_t mem_frame,	int8_t rate);
void player_stop_mem(void);
void payer_handler(void);
void player_play_mem(uint16_t mem_number, uint8_t mem_frame,	uint8_t rate);
void player_start_mem(uint16_t mem_number, uint8_t mem_frame,	int8_t rate);
void player_synchro(uint16_t mem_number, uint8_t mem_frame,	int8_t rate, uint8_t crossfade);

#endif

